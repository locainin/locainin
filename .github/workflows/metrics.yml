---
name: Metrics

"on":
  push:
    branches:
      - main
    paths:
      - ".github/workflows/metrics.yml"
      - "README.md"
  schedule:
    - cron: "0 6 * * *"
  workflow_dispatch:

permissions:
  contents: write

# Prevent overlapping runs so generated SVG commits are deterministic
concurrency:
  group: metrics
  cancel-in-progress: true

jobs:
  github-metrics:
    runs-on: ubuntu-latest
    steps:
      - name: Used languages
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.plugin.languages.details.svg
          token: ${{ secrets.METRICS_TOKEN || github.token }}
          output_action: commit
          base: ""
          plugin_languages: "yes"
          plugin_languages_indepth: "yes"
          plugin_languages_limit: 8
          plugin_languages_details: bytes-size, percentage

      - name: Coding habits
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.plugin.habits.facts.svg
          token: ${{ secrets.METRICS_TOKEN || github.token }}
          output_action: commit
          base: ""
          plugin_habits: "yes"
          plugin_habits_facts: "yes"
          plugin_habits_charts: "no"
